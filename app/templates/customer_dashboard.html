{% extends "base.html" %}

{% block title %}Customer Dashboard - HomeServe Pro{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 bg-light sidebar">
            <div class="position-sticky pt-3">
                <h5 class="text-primary mb-3">Customer Menu</h5>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('overview')">
                            <i class="fas fa-home me-2"></i>Overview
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('bookings')">
                            <i class="fas fa-calendar me-2"></i>My Bookings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('services')">
                            <i class="fas fa-tools me-2"></i>Book Service
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('vendors')">
                            <i class="fas fa-user-tie me-2"></i>Browse Vendors
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('profile')">
                            <i class="fas fa-user me-2"></i>Profile
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-danger" href="#" onclick="logout()">
                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10 ms-sm-auto px-md-4">
            <!-- Header -->
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Customer Dashboard</h1>
                <div>
                    <span class="badge bg-success">Active</span>
                    <span id="userName" class="ms-2 text-muted"></span>
                </div>
            </div>

            <!-- Overview Section -->
            <div id="overviewSection" class="dashboard-section">
                <div class="row g-4 mb-4">
                    <div class="col-md-4">
                        <div class="card text-white bg-primary">
                            <div class="card-body">
                                <h5 class="card-title">Total Bookings</h5>
                                <h2 id="totalBookings">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-success">
                            <div class="card-body">
                                <h5 class="card-title">Completed</h5>
                                <h2 id="completedBookings">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-warning">
                            <div class="card-body">
                                <h5 class="card-title">Pending</h5>
                                <h2 id="pendingBookings">0</h2>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Welcome to HomeServe Pro!</h5>
                    </div>
                    <div class="card-body">
                        <p>Book professional home services with just a few clicks.</p>
                        <button class="btn btn-primary" onclick="showSection('services')">
                            <i class="fas fa-plus me-2"></i>Book a Service
                        </button>
                    </div>
                </div>
            </div>

            <!-- Bookings Section -->
            <div id="bookingsSection" class="dashboard-section d-none">
                <h3 class="mb-4">My Bookings</h3>
                <div id="bookingsList">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Section -->
            <div id="servicesSection" class="dashboard-section d-none">
                <h3 class="mb-4">Available Services</h3>
                <div id="servicesList">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vendors Section -->
            <div id="vendorsSection" class="dashboard-section d-none">
                <h3 class="mb-4">Available Vendors</h3>

                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row g-2 align-items-end">
                            <div class="col-md-5">
                                <label class="form-label">Service</label>
                                <select id="vendorServiceSelect" class="form-select"></select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Pincode</label>
                                <input id="vendorPincode" class="form-control" placeholder="e.g., 560001" maxlength="6">
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary w-100" onclick="loadVendors()">
                                    <i class="fas fa-search me-2"></i>Find Providers
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="vendorsList">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary"></div>
                        <p class="mt-2">Loading vendors...</p>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="dashboard-section d-none">
                <h3 class="mb-4">Profile Settings</h3>
                <div class="card">
                    <div class="card-body">
                        <form id="profileForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="profileName" class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="profileName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="profileEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="profileEmail" readonly>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="profilePhone" class="form-label">Phone</label>
                                    <input type="tel" class="form-control" id="profilePhone" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="profilePincode" class="form-label">Pincode</label>
                                    <input type="text" class="form-control" id="profilePincode" maxlength="6">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="profileAddress" class="form-label">Address</label>
                                <textarea class="form-control" id="profileAddress" rows="3"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Save Changes
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Booking Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Book Service</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="bookingForm">
                    <input type="hidden" id="bookingServiceId">
                    <input type="hidden" id="bookingServiceName">

                    <div class="mb-3">
                        <label class="form-label">Service</label>
                        <input type="text" class="form-control" id="displayServiceName" readonly>
                    </div>

                    <div class="mb-3">
                        <label for="bookingAddress" class="form-label">Service Address *</label>
                        <textarea class="form-control" id="bookingAddress" rows="2" required></textarea>
                    </div>

                    <div class="mb-3">
                        <label for="bookingPincode" class="form-label">Pincode *</label>
                        <input type="text" class="form-control" id="bookingPincode" maxlength="6" pattern="[0-9]{6}" required>
                    </div>

                    <div class="mb-3">
                        <label for="bookingDate" class="form-label">Service Date *</label>
                        <input type="date" class="form-control" id="bookingDate" required>
                    </div>

                    <div class="mb-3">
                        <label for="bookingTime" class="form-label">Preferred Time *</label>
                        <input type="time" class="form-control" id="bookingTime" required>
                    </div>

                    <div class="mb-3">
                        <label for="bookingDescription" class="form-label">Special Instructions (Optional)</label>
                        <textarea class="form-control" id="bookingDescription" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitBooking()">
                    <span id="bookingBtnText">Confirm Booking</span>
                    <span id="bookingBtnSpinner" class="spinner-border spinner-border-sm d-none"></span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    let currentUser = null;

    // Check authentication on page load
    document.addEventListener('DOMContentLoaded', async () => {
        const token = localStorage.getItem('access_token');
        if (!token) {
            window.location.href = '/login';
            return;
        }

        // Load user data
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        currentUser = user;
        document.getElementById('userName').textContent = user.name || user.email;

        // Load dashboard data
        await loadDashboardData();
    });

    async function loadDashboardData() {
        await loadBookings();
    }

    async function loadBookings() {
        try {
            const token = localStorage.getItem('access_token');
            const response = await fetch('/api/customer/bookings', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            const data = await response.json();

            if (data.success) {
                const bookings = data.data || [];

                // Update statistics
                document.getElementById('totalBookings').textContent = bookings.length;
                document.getElementById('completedBookings').textContent =
                    bookings.filter(b => b.status === 'completed').length;
                document.getElementById('pendingBookings').textContent =
                    bookings.filter(b => b.status === 'pending' || b.status === 'accepted').length;

                // Update bookings list
                const bookingsList = document.getElementById('bookingsList');
                if (bookings.length > 0) {
                    bookingsList.innerHTML = '<div class="row g-3"></div>';
                    const row = bookingsList.querySelector('.row');

                    bookings.forEach(booking => {
                        const statusBadge = getStatusBadge(booking.status);
                        const bookingDate = new Date(booking.created_at).toLocaleDateString();

                        row.innerHTML += `
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <h5 class="mb-0">${booking.service_name || 'Service'}</h5>
                                            ${statusBadge}
                                        </div>
                                        <p class="text-muted small mb-2">
                                            <i class="fas fa-calendar me-1"></i>${bookingDate}
                                        </p>
                                        <p class="text-muted small mb-2">
                                            <i class="fas fa-map-marker-alt me-1"></i>${booking.address || 'N/A'}
                                        </p>
                                        ${booking.vendor_name ? `<p class="text-muted small mb-2"><i class="fas fa-user me-1"></i>Vendor: ${booking.vendor_name}</p>` : ''}
                                        <div class="d-flex gap-2 mt-3">
                                            <button class="btn btn-sm btn-outline-primary" onclick="viewBookingDetails('${booking._id || booking.id}')">
                                                <i class="fas fa-eye me-1"></i>View Details
                                            </button>
                                            ${booking.status === 'pending' ? `
                                                <button class="btn btn-sm btn-outline-danger" onclick="cancelBooking('${booking._id || booking.id}')">
                                                    <i class="fas fa-times me-1"></i>Cancel
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    bookingsList.innerHTML = `
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            You haven't made any bookings yet.
                            <a href="#" onclick="showSection('services'); return false;" class="alert-link">Book a service now!</a>
                        </div>
                    `;
                }
            }
        } catch (error) {
            console.error('Error loading bookings:', error);
            const bookingsList = document.getElementById('bookingsList');
            bookingsList.innerHTML = `
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Unable to load bookings. Please try again later.
                </div>
            `;
        }
    }

    function getStatusBadge(status) {
        const badges = {
            'pending': '<span class="badge bg-warning">Pending</span>',
            'accepted': '<span class="badge bg-info">Accepted</span>',
            'in_progress': '<span class="badge bg-primary">In Progress</span>',
            'completed': '<span class="badge bg-success">Completed</span>',
            'cancelled': '<span class="badge bg-danger">Cancelled</span>'
        };
        return badges[status] || '<span class="badge bg-secondary">Unknown</span>';
    }

    function viewBookingDetails(bookingId) {
        alert('Booking details view coming soon!\nBooking ID: ' + bookingId);
    }

    async function cancelBooking(bookingId) {
        if (!confirm('Are you sure you want to cancel this booking?')) {
            return;
        }

        try {
            const token = localStorage.getItem('access_token');
            const response = await fetch(`/api/customer/bookings/${bookingId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            const data = await response.json();

            if (data.success) {
                alert('Booking cancelled successfully!');
                await loadBookings();
            } else {
                alert('Failed to cancel booking: ' + (data.message || 'Unknown error'));
            }
        } catch (error) {
            console.error('Error cancelling booking:', error);
            alert('Error cancelling booking. Please try again.');
        }
    }

    function showSection(section) {
        // Hide all sections
        document.querySelectorAll('.dashboard-section').forEach(s => s.classList.add('d-none'));

        // Show selected section
        document.getElementById(section + 'Section').classList.remove('d-none');

        // Update active nav
        document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        if (event && event.target) {
            event.target.classList.add('active');
        }

        // Load section data
        if (section === 'services') {
            loadServices();
        } else if (section === 'vendors') {
            initVendorsFilters();
            loadVendors();
        } else if (section === 'bookings') {
            loadBookings();
        } else if (section === 'profile') {
            loadProfile();
        }
    }

    async function loadServices() {
        const servicesList = document.getElementById('servicesList');
        servicesList.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-primary"></div><p class="mt-2">Loading services...</p></div>';

        try {
            const token = localStorage.getItem('access_token');
            const response = await fetch('/api/customer/services', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            const data = await response.json();

            if (data.success && data.data && data.data.length > 0) {
                servicesList.innerHTML = '<div class="row g-3"></div>';
                const row = servicesList.querySelector('.row');

                data.data.forEach(service => {
                    const serviceId = service._id || service.id;
                    row.innerHTML += `
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="bg-primary text-white rounded-circle p-2 me-2">
                                            <i class="fas fa-tools"></i>
                                        </div>
                                        <h5 class="mb-0">${service.name}</h5>
                                    </div>
                                    <p class="text-muted small">${service.description || 'Professional service at your doorstep'}</p>
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <div>
                                            <h5 class="text-primary mb-0">₹${service.base_price || 0}</h5>
                                            <small class="text-muted">Starting price</small>
                                        </div>
                                        <div>
                                            <small class="text-muted"><i class="fas fa-clock"></i> ${service.duration_minutes || 60} mins</small>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-sm w-100 mt-3" onclick="bookService('${serviceId}', '${service.name}')">
                                        <i class="fas fa-calendar-check me-1"></i>Book Now
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            } else {
                servicesList.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No services available at the moment. Please check back later.
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading services:', error);
            servicesList.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Error loading services. Please try again later.
                </div>
            `;
        }
    }

    function bookService(serviceId, serviceName) {
        // Populate modal with service info
        document.getElementById('bookingServiceId').value = serviceId;
        document.getElementById('bookingServiceName').value = serviceName;
        document.getElementById('displayServiceName').value = serviceName;

        // Pre-fill user data if available
        if (currentUser.address) {
            document.getElementById('bookingAddress').value = currentUser.address;
        }
        if (currentUser.pincode) {
            document.getElementById('bookingPincode').value = currentUser.pincode;
        }

        // Set default date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('bookingDate').value = tomorrow.toISOString().split('T')[0];

        // Set default time to 10:00 AM
        document.getElementById('bookingTime').value = '10:00';

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('bookingModal'));
        modal.show();
    }

    async function submitBooking() {
        const form = document.getElementById('bookingForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        const serviceId = document.getElementById('bookingServiceId').value;
        const address = document.getElementById('bookingAddress').value;
        const pincode = document.getElementById('bookingPincode').value;
        const serviceDate = document.getElementById('bookingDate').value;
        const serviceTime = document.getElementById('bookingTime').value;
        const description = document.getElementById('bookingDescription').value;

        // Show loading
        const btnText = document.getElementById('bookingBtnText');
        const btnSpinner = document.getElementById('bookingBtnSpinner');
        btnText.classList.add('d-none');
        btnSpinner.classList.remove('d-none');

        try {
            const token = localStorage.getItem('access_token');
            const response = await fetch('/api/customer/bookings', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    service_id: serviceId,
                    service_date: serviceDate,
                    service_time: serviceTime,
                    address: address,
                    pincode: pincode,
                    description: description
                })
            });

            const data = await response.json();

            if (data.success) {
                // Hide modal
                bootstrap.Modal.getInstance(document.getElementById('bookingModal')).hide();

                // Show success message
                alert('✅ Booking created successfully!\n\nYour booking has been submitted and a vendor will be assigned soon.');

                // Refresh bookings and switch to bookings section
                await loadBookings();
                showSection('bookings');
            } else {
                alert('❌ Failed to create booking:\n\n' + (data.message || 'Unknown error'));
            }
        } catch (error) {
            console.error('Error creating booking:', error);
            alert('❌ Error creating booking:\n\n' + error.message + '\n\nPlease try again.');
        } finally {
            // Hide loading
            btnText.classList.remove('d-none');
            btnSpinner.classList.add('d-none');
        }
    }

    async function initVendorsFilters() {
        const select = document.getElementById('vendorServiceSelect');
        if (select.dataset.loaded === 'true') {
            document.getElementById('vendorPincode').value = currentUser.pincode || '';
            return;
        }
        try {
            const resp = await fetch('/api/services');
            const data = await resp.json();
            select.innerHTML = '<option value="">All Services</option>';
            if (data.success && Array.isArray(data.data)) {
                data.data.forEach(svc => {
                    const opt = document.createElement('option');
                    opt.value = svc._id || svc.id;
                    opt.textContent = svc.name;
                    select.appendChild(opt);
                });
            }
            select.dataset.loaded = 'true';
            document.getElementById('vendorPincode').value = currentUser.pincode || '';
        } catch (e) {
            console.error('Failed to load services for vendors filter', e);
        }
    }

    async function loadVendors() {
        const list = document.getElementById('vendorsList');
        list.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-primary"></div><p class="mt-2">Loading vendors...</p></div>';
        try {
            const serviceId = document.getElementById('vendorServiceSelect').value;
            const pincode = document.getElementById('vendorPincode').value.trim();
            const params = new URLSearchParams();
            if (serviceId) params.set('service_id', serviceId);
            if (pincode) params.set('pincode', pincode);
            params.set('availability', 'true');
            const resp = await fetch('/api/vendors?' + params.toString());
            const data = await resp.json();
            if (data.success) {
                renderVendors(data.data || []);
            } else {
                list.innerHTML = '<div class="alert alert-warning">Failed to load vendors.</div>';
            }
        } catch (e) {
            console.error('Failed to load vendors', e);
            list.innerHTML = '<div class="alert alert-danger">Error loading vendors.</div>';
        }
    }

    function renderVendors(vendors) {
        const list = document.getElementById('vendorsList');
        if (!vendors || vendors.length === 0) {
            list.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle me-2"></i>No vendors found for your filters.</div>';
            return;
        }
        let html = '<div class="row g-3">';
        vendors.forEach(v => {
            const rating = (v.ratings || 0).toFixed(1);
            const services = (v.services || []).slice(0, 3).map(s => `<span class=\"badge bg-light text-dark me-1 mb-1\">${s}</span>`).join(' ');
            html += `
            <div class="col-md-6 col-lg-4">
              <div class="card h-100 shadow-sm">
                <div class="card-body">
                  <div class="d-flex align-items-center mb-2">
                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-2" style="width:40px;height:40px;">
                      <i class="fas fa-user-tie"></i>
                    </div>
                    <div>
                      <h5 class="mb-0">${v.name || 'Vendor'}</h5>
                      <small class="text-muted"><i class="fas fa-star text-warning"></i> ${rating} (${v.total_ratings || 0})</small>
                    </div>
                  </div>
                  <div class="mb-2">${services || '<small class="text-muted">No services listed</small>'}</div>
                  <div class="d-flex justify-content-between align-items-center mt-2">
                    <span class="badge ${v.availability ? 'bg-success' : 'bg-secondary'}">${v.availability ? 'Available' : 'Offline'}</span>
                    <button class="btn btn-sm btn-outline-primary" onclick="openBookingForVendor('${v.id}', '${(v.services && v.services[0]) || ''}')">
                      <i class="fas fa-calendar-plus me-1"></i>Book
                    </button>
                  </div>
                </div>
              </div>
            </div>`;
        });
        html += '</div>';
        list.innerHTML = html;
    }

    function openBookingForVendor(vendorId, serviceNameGuess) {
        const sel = document.getElementById('vendorServiceSelect');
        const selectedOption = sel.options[sel.selectedIndex];
        const serviceId = selectedOption && selectedOption.value ? selectedOption.value : '';
        const serviceName = selectedOption && selectedOption.text ? selectedOption.text : (serviceNameGuess || 'Service');
        if (!serviceId) {
            alert('Please select a service first.');
            return;
        }
        bookService(serviceId, serviceName);
    }



    function loadProfile() {
        document.getElementById('profileName').value = currentUser.name || '';
        document.getElementById('profileEmail').value = currentUser.email || '';
        document.getElementById('profilePhone').value = currentUser.phone || '';
        document.getElementById('profileAddress').value = currentUser.address || '';
        document.getElementById('profilePincode').value = currentUser.pincode || '';
    }

    // Handle profile form submission
    document.addEventListener('DOMContentLoaded', () => {
        const profileForm = document.getElementById('profileForm');
        if (profileForm) {
            profileForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const updatedData = {
                    name: document.getElementById('profileName').value,
                    phone: document.getElementById('profilePhone').value,
                    address: document.getElementById('profileAddress').value,
                    pincode: document.getElementById('profilePincode').value
                };

                try {
                    const token = localStorage.getItem('access_token');
                    const response = await fetch('/api/profile', {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updatedData)
                    });

                    const data = await response.json();

                    if (data.success) {
                        alert('✅ Profile updated successfully!');
                        // Update local storage
                        currentUser = { ...currentUser, ...updatedData };
                        localStorage.setItem('user', JSON.stringify(currentUser));
                        document.getElementById('userName').textContent = currentUser.name;
                    } else {
                        alert('❌ Failed to update profile: ' + (data.message || 'Unknown error'));
                    }
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('❌ Error updating profile. Please try again.');
                }
            });
        }
    });

    function logout() {
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        localStorage.removeItem('user');
        window.location.href = '/login';
    }
</script>

<style>
    .sidebar {
        min-height: 100vh;
    }
    .nav-link {
        color: #333;
        padding: 10px 15px;
        border-radius: 5px;
        margin-bottom: 5px;
    }
    .nav-link:hover, .nav-link.active {
        background-color: #e9ecef;
        color: #0d6efd;
    }
</style>
{% endblock %}

